# Prometheus?

SoundCloud에서 개발한 오픈소스 모니터링 시스템이자 일림 툴킷이다.    
이제는 독립형 오픈 소스 프로젝트이며,   
오픈 소스라는 사실을 알리고 프로젝트의 커버넌스 구조를 확립하기 위한 일환으로     
프로메테우스는 2016년에 쿠버네티르스를 잇는 두번째 호스팅 프로젝트로   
Cloud Native Computing Foundation 에 합류했다.     

프로메테우스는 메트릭을 **시계열 데이터**로 수집해 저장한다.        
메트릭 정보는 정보를 수집한 타임스탬프와 함께 저장하며       
키-값 쌍으로 구성된 레이블도 함께 저장할 수 있다.       

## Features   

* 메트릭 이름과 키/값 쌍으로 식별하는 다차원 데이터 모델을 시계열로 저장
* 다차원 모델을 다각도로 활용할 수 있는 유연한 쿼리 언어 PromQL 
* 분산 스토리지에 의존하지 않고 모든 서버 노드가 자율적으로 동작 
* HTTP를 통한 pull 모델로 시계열 수집 
* 중간 게이트웨이를 통한 시계열 push 지원
* 서비스 디스커버리나 스태틱 설정을 통한 모니터링 대상 타겟팅
* 다양한 그래프, 대시보드 모드 지원 


## Metrics
  
메트릭은 숫자로 측정한 값을 의미한다.         
시계열이란 말은 시간이 흐르면서 바뀌는 값들을 기록한다는 뜻이다.        
측정하고 싶은 값은 애플리케이션마다 다를 것이다.(웹 서버 - 요청시간, DB - 커넥션수)        
 
메트릭을 수집하면 애플리케이션의 동작 이유를 파악할 수 있다.     
예를 들어, '요청 수'를 메트릭하고 있다면 과한 요청에 따라 느려짐을 파악할 수 있다.   

## Componenets

프로메테우스 에코시스템은 다양한 컴포넌트로 이루어져 있으며, 컴포넌트 대부분은 옵션이다.   

* 시계열 데이터를 스크랩하고 저장하는 메인 프로메테우스 서버
* 애플리케이션 코드 계측용 클라이언트 라이브러리
* short-lived job 을 지원하는 푸시 게이트웨이
* HAProxy, StatsD, Graphite 등의 서비스를 위한 전용 익스포터들
* alert을 처리해주는 alertmanager 
* 다양한 지원 도구들 

프로메테우스 컴포넌트는 대부분 GO로 작성되어있기에 정적 바이너리로 쉽게 빌드하고 배포할 수 있다.  

# Architecture  
  
아래는 프로메테우스와 몇 가지 에코시스템 컴포넌트들의 아키텍처를 나타낸 다이어그램이다.  

![architecture](https://user-images.githubusercontent.com/50267433/165870249-914cd099-8f73-4124-bae2-ca44d2e24b46.png)

프로메테우스는 **설정한 Job에서 직접 메트릭을 스크랩하며**    
short-lived job 에서 중간 푸시 게이트웨이를 거치기도 한다.   
스크랩한 샘플은 모두 로컬에 저장하며       
설정해둔 rule 들을 실행해 기존 데이터를 집계하고 새 시계열을 기록하거나 alert을 생성한다.    
그라파나나 기타 API 컨슈머를 사용하면 수집한 데이털르 시각화할 수 있다.    

  





